# README.md
# Royal Bot

**Royal Bot** — это модульный, расширяемый Telegram-бот для автоматизации работы администраторов, бронирования, управления пользователями и ведения учёта. Построен на асинхронном Python-стеке (aiogram 3, PostgreSQL), с поддержкой мультиязычности и прав доступа.

---

## Структура репозитория

```
royal_bot/
├── constants/         # Константы, справочники, статусы, сообщения и настройки
├── db_access/         # Класс-репозитории и методы прямого доступа к БД
├── handlers/          # Все обработчики команд, callback, логика меню, бронирований и админки
├── states/            # FSM-состояния для пошаговых диалогов
├── tests/             # Покрытие тестами (unittest/pytest)
├── utils/             # Утилиты: текст, даты, локализация и др.
├── app_states.py      # Глобальные статусы приложения
├── config.py          # Загрузка ENV, проверка админов, токены
├── db.py              # Инициализация базы данных и пул соединений
├── ffmpeg.py          # Интеграция с ffmpeg для мультимедиа
├── main.py            # Точка входа, сборка и запуск бота
├── requirements.txt   # Все зависимости Python
└── .gitignore         # Исключения для Git
```

---

## Краткое описание ключевых файлов и папок

### main.py

* Главный исполняемый файл.
* Запускает aiogram-бота, инициализирует Dispatcher, пул соединений с БД, регистрирует все роутеры.
* Весь жизненный цикл приложения начинается отсюда.

### config.py

* Загружает переменные окружения (токен, ADMIN\_IDS, строку подключения к БД).
* Реализует функцию проверки, является ли пользователь админом.

### db.py

* Управляет пулом соединений PostgreSQL (asyncpg).
* Создаёт необходимые таблицы при старте, проверяет наличие всех структур в базе.

### constants/

* booking\_const.py — статусы, идентификаторы, текстовые константы для бронирования.
* salary.py — параметры расчёта зарплат, правила начисления.

### handlers/

* menu\_ad.py — админ-меню: кнопки, права, доступ к управлению разделами.
* startemoji.py — присвоение эмодзи, ручное и автоматическое управление эмодзи пользователями.
* news.py, salary.py, clean.py, cancelbook.py, money.py — логика работы с новостями, зарплатой, отчисткой данных, отменой бронирования, управлением балансами и денежными операциями.
* group\_id.py — обработка групповых идентификаторов.
* booking/ — вложенная логика для обработки бронирования, платежей, распределения денег между участниками, отчётов.

### states/

* admin\_states.py, booking\_states.py и др. — FSM-состояния для ветвления диалогов, удобное управление многошаговыми процессами.

### db\_access/

* booking\_repo.py — работа с таблицами бронирований, абстракция над SQL-запросами.

### utils/

* user\_utils.py, text\_utils.py, time\_utils.py — локализация, обработка и генерация текстов, форматирование, управление датами и временем, генерация сообщений, парсинг языков, конвертация времени.

---

## Запуск проекта

1. **Установи зависимости:**

   ```
   pip install -r requirements.txt
   ```

2. **Создай файл `.env`** или задай переменные окружения:

   ```
   TELEGRAM_BOT_TOKEN=...
   DATABASE_URL=postgresql://user:pass@host:5432/db
   ADMIN_IDS=123456789,987654321
   ```

3. **Инициализация базы данных**:
   При первом запуске необходимые таблицы будут созданы автоматически. Проверь логи: "Все таблицы созданы или проверены".

4. **Запуск:**

   ```
   python main.py
   ```

---

## Функциональные возможности

* **Многоуровневое меню для админов и пользователей**
* **Гибкая роль админа** (через ADMIN\_IDS)
* **Бронирование, отчёты, зарплаты, новости**
* **Мультиязычная поддержка**
* **Работа с медиа (через ffmpeg, если требуется)**
* **Асинхронные запросы к PostgreSQL**
* **Управление правами доступа через FSM**
* **Удобная система эмодзи-идентификации пользователей**
* **Автоматизированные уведомления и отчёты**
* **Модульные хендлеры — легко расширять**

---

## Лицензия

MIT

---

## TODO

* Подробная документация каждого модуля и REST API (часть 2)
* Примеры SQL-структуры БД (часть 3)
* Инструкция по деплою на сервер (часть 4)

---

*Это часть первая.
В следующей части будет подробная документация по каждому отдельному модулю с разъяснением всех публичных функций и примерами использования.*
